<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

    <style>
      body {
        background-image: url("termina-back.JPG");
        background-repeat: no-repeat;
        background-size: cover;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5 p-5 bg-primary">
      <div class="row">
        <div class="col-md-4">
          <div class="card">
            <div class="card-header">
              <h4 class="text-center">Add Drama</h4>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label for="">Kode Drama</label>
                <input
                  type="text"
                  class="form-control"
                  id="kodedrama"
                  placeholder="Masukan Kode Drama"
                />
              </div>
              <div class="form-group">
                <label for="">Gambar</label>
                <input
                  type="file"
                  name="gambar"
                  value="upload image"
                  id="gambar"
                />
              </div>
              <div class="form-group">
                <label for="">Judul</label>
                <input
                  type="text"
                  name="judul"
                  placeholder="Masukan Judul"
                  class="form-control"
                  id="judul"
                />
              </div>
              <div class="form-group">
                <label for="">Genre</label>
                <input
                  type="text"
                  name="genre"
                  placeholder="Masukan Genre"
                  class="form-control"
                  id="genre"
                />
              </div>
              <div class="form-group">
                <label for="">Tanggal Tayang</label>
                <input
                  type="date"
                  name="tanggal_tayang"
                  class="form-control"
                  id="tanggal_tayang"
                />
              </div>
              <div class="form-group">
                <label for="">Sinopsis</label>
                <input
                  type="text"
                  name="sinopsis"
                  placeholder="Masukan Sinopsis"
                  class="form-control"
                  id="sinopsis"
                />
              </div>
              <div class="form-group">
                <label for="">Sutradara</label>
                <input
                  type="text"
                  name="sutradara"
                  placeholder="Masukan Nama Sutradara"
                  class="form-control"
                  id="sutradara"
                />
              </div>
              <div class="form-group">
                <label for="">Pemeran</label>
                <input
                  type="text"
                  name="pemeran"
                  placeholder="Masukan Nama Pemeran"
                  class="form-control"
                  id="pemeran"
                />
              </div>

              <div class="mt-3">
                <button
                  class="btn btn-primary float-right"
                  onclick="submitForm()"
                >
                  Submit
                </button>
              </div>
              <div class="w-100">
                <span id="message" class="text-success"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-8">
          <table class="table table-bordered text-white text-center">
            <thead>
              <th>Kode Drama</th>
              <th>Gambar</th>
              <th>Judul</th>
              <th>Genre</th>
              <th>Tanggal Tayang</th>
              <th>Sinopsis</th>
              <th>Sutradara</th>
              <th>Pemeran</th>
              <th>Edit</th>
              <th>Delete</th>
            </thead>
            <tbody id="tbData"></tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      var editFormData;

      function getFormData() {
        return {
          id_drama: document.getElementById("id_drama").value,
          gambar: document.getElementById("gambar").value,
          judul: document.getElementById("judul").value,
          genre: document.getElementById("genre").value,
          tanggal_tayang: document.getElementById("tanggal_tayang").value,
          sinopsis: document.getElementById("sinopsis").value,
          pemeran: document.getElementById("pemeran").value,
        };
      }
      function clearFormData() {
        document.getElementById("id_drama").value = "";
        document.getElementById("gambar").value = "";
        document.getElementById("judul").value = "";
        document.getElementById("genre").value = "";
        document.getElementById("tanggal_tayang").value = "";
        document.getElementById("sinopsis").value = "";
        document.getElementById("sutradara").value = "";
        document.getElementById("pemeran").value = "";
      }

      function setFormData(
        id_drama,
        gambar,
        judul,
        genre,
        tanggal_tayang,
        sinopsis,
        sutradara,
        pemeran
      ) {
        document.getElementById("id_drama").value = id_drama;
        document.getElementById("gambar").value = gambar;
        document.getElementById("judul").value = judul;
        document.getElementById("genre").value = genre;
        document.getElementById("tanggal_tayang").value = tanggal_tayang;
        document.getElementById("sinopsis").value = sinopsis;
        document.getElementById("sutradara").value = sutradara;
        document.getElementById("pemeran").value = pemeran;
      }

      // set the message for form status
      function setSuccessMessage(message) {
        document.getElementById("message").innerHTML = message;
      }
      function editDataCall(id) {
        // call get user details by id API
        fetch(
          "http://localhost/webdramaindonesia/api/api_tampil_byid.php?id_drama=" +
            id,
          {
            method: "GET",
          }
        )
          .then((res) => res.json())
          .then((response) => {
            console.log("Edit info", response);
            editFormData = response[0];
            setFormData(
              editFormData.id_drama,
              editFormData.gambar,
              editFormData.judul,
              editFormData.genre,
              editFormData.tanggal_tayang,
              editFormData.sinopsis,
              editFormData.sutradara,
              editFormData.pemeran
            );
          });
      }

      // callled this function when user click on button
      function submitForm() {
        if (!editFormData)
          addUser(); // if the editFormData is undefined then call addUser()
        else editData();
      }
      // add user function
      function addUser() {
        let payload = getFormData();
        fetch("http://localhost/webdramaindonesia/api/api_tambah.php", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(payload),
        })
          .then((res) => res.json())
          .then((response) => {
            setSuccessMessage(response.message);
            // clear input email and name
            clearFormData();
            getData(); // reload table
          });
      }

      // edit data
      function editData() {
        var formData = getFormData();
        formData["id_drama"] = editFormData._id; // get _id from selected user
        fetch("http://localhost/webdramaindonesia/api/api_edit.php", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(formData),
        })
          .then((res) => res.json())
          .then((response) => {
            setSuccessMessage(response.message);
            clearFormData(); // clear the form field
            getData(); // reload the table
          });
      }

      // delete data
      function deleteData(id) {
        fetch("http://localhost/webdramaindonesia/api/api_hapus.php?id=" + id)
          .then((res) => res.json())
          .then((response) => {
            setSuccessMessage(response.message);
            getData();
          });
      }

      // get data method

      function getData() {
        fetch("http://localhost/webdramaindonesia/api/api_tampil_all.php")
          .then((res) => res.json())
          .then((response) => {
            var tmpData = "";
            console.log(response);
            response.forEach((user) => {
              tmpData += "<tr>";
              tmpData += "<td>" + user.id_drama + "</td>";
              tmpData += "<td>" + user.gambar + "</td>";
              tmpData += "<td>" + user.judul + "</td>";
              tmpData += "<td>" + user.genre + "</td>";
              tmpData += "<td>" + user.tanggal_tayang + "</td>";
              tmpData += "<td>" + user.sinopsis + "</td>";
              tmpData += "<td>" + user.sutradara + "</td>";
              tmpData += "<td>" + user.pemeran + "</td>";
              tmpData +=
                "<td><button class='btn btn-primary' onclick='editDataCall(`" +
                user._id +
                "`)'>Edit</button></td>";
              tmpData +=
                "<td><button class='btn btn-danger' onclick='deleteData(`" +
                user._id +
                "`)'>Delete</button></td>";

              tmpData += "</tr>";
            });
            document.getElementById("tbData").innerHTML = tmpData;
          });
      }

      getData();
    </script>
  </body>
</html>
